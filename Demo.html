<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html> 
<head> 

<!-- BEGIN /xnat-templates/screens/XIViewer.vm -->

<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/closure-library/closure/goog/css/menu.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/closure-library/closure/goog/css/menuitem.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/closure-library/closure/goog/css/menuseparator.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/closure-library/closure/goog/css/menubutton.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/closure-library/closure/goog/css/custombutton.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/closure-library/closure/goog/css/checkbox.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/closure-library/closure/goog/css/hsvpalette.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/closure-library/closure/goog/css/dialog.css">

<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/nrg/css/genericslider.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/nrg/css/scrollablecontainer.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/nrg/css/scrollablezippytree.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/nrg/css/zippynode.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/nrg/css/zippytree.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/nrg/css/dialog.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/nrg/css/errordialog.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/nrg/css/thumbnail.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/nrg/css/thumbnailgallery.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/nrg/css/resizable.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/nrg/css/resizedragger.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/nrg/css/tabs.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/nrg/css/ziptabs.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/nrg/css/slideinmenu.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/xtkcontroller.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/xtkplane.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/displayall.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/slidercontroller.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/buttoncontroller.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/twothumbslidercontroller.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/checkboxcontroller.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/radiobuttoncontroller.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/colorpalettecontroller.css">

<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/helpdialog.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/viewbox.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/viewboxdialogs.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/viewboxinteractorhandler.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/modal.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/thumbnail.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/thumbnailgallery.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/viewboxhandler.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/layouthandler.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/layout.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/xyzvlayout.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/conventional.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/fourup.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/twodrow.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/twodwidescreen.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/layoutframe.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/progressbarpanel.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/histogram.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/viewablegroupmenu.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/crosshairs.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/inputcontroller.css">

<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/framedisplay.css">
<link type="text/css" rel="stylesheet" href="src/main/scripts/viewer/xiv/css/zoomdisplay.css">


<script src="src/main/scripts/viewer/closure-library/closure/goog/base.js"></script>
<script src="src/main/scripts/viewer/X/xtk-deps.js"></script>
<script src="src/main/scripts/viewer/_custom/X/xtk-custom-deps.js"></script>
<script src="src/main/scripts/viewer/jszip/jszip.js"></script>
<script src="src/main/scripts/viewer/nrg/nrg-deps.js"></script>
<script src="src/main/scripts/viewer/gxnat/gxnat-deps.js"></script>
<script src="src/main/scripts/viewer/xiv/xiv-deps.js"></script>
<script>
goog.require('xiv.start');
goog.require('xiv.ui.Modal');
goog.require('xiv.utils.ErrorCatcher');
goog.require('xiv.utils.objectAnalyzer');
</script>

<!--
<script>
  window.console.log('using xiv-min.js')
</script>
<script src="src/main/scripts/viewer/jszip/jszip.min.js"></script>
<script src="src/main/scripts/viewer/xiv-min.js"></script>
-->


</head>
<body>

<script>


//
// globals
//
XIV_STATE = 'demo';


/**
 * Main launch function for the XNAT Image Viewer.
 * NOTES: 
 *     - the 'serverRoot' property is a global defined by the VM if launched
 *       directly from an XNATUrl.  Otherwise it's blank.
 * 
 * @preserve Copyright 2014 Washington University
 * @author sunilk@mokacreativellc.com (Sunil Kumar)
 * @author herrickr@mir.wustl.edu (Rick Herrick)
 *
 * @param {!string} opt_dataPath The optional data path to begin the 
 *    viewer from.  Defaults to the Velocity generated URL 
 *    (e.g. 'projects/$om.getProject()/subjects/$om.getSubjectId()/' + 
 *          'experiments/$om.getId()')
 * @param {!string} opt_modalState The modal state to set the image viewer to.
 * @param {!string} opt_serverRoot The optional server root.
 */
function launchXImgView(opt_dataPath, opt_modalState, opt_serverRoot) {

    //window.console.log('xiv', xiv);  
    //window.console.log('compat', xiv.isCompatible);
    //window.console.log('root', xiv.prototype.setServerRoot);
    //window.console.log('states', xiv.ui.Modal);

    //-------------------
    // We need to set the global serverRoot property if opt_serverRoot is 
    // argument is given.
    //
    // NOTE: 'serverRoot' is automatically provided in the live version (in the 
    // VM) but in the demo version, we have to provide this global variable.
    //-------------------
    if (opt_serverRoot){
        serverRoot = opt_serverRoot;
    }


    //-------------------
    // Verify compatibilities (browser, WebGL, etc.)
    //-------------------
    if (!xiv.utils.ErrorCatcher.isCompatible()){
        return;
    } 


    //-------------------
    // Set the modalState argument ('windowed', 'popup', etc.)
    //-------------------
    var modalState = (opt_modalState != undefined && opt_modalState != null) ? 
        opt_modalState : 'windowed';


    //-------------------
    // Set the dataPath argument (i.e. where to query the data from).  
    //
    // NOTE: If we're in popup mode, we take the data path from the URL of the
    // page, which is fed in as a query string
    //-------------------
    var dataPath = '';
    if (opt_modalState != undefined && 
        opt_modalState === 'popup') {
        dataPath = document.URL.split('?')[1];
    }
    else {
        dataPath = (opt_dataPath != undefined && opt_dataPath != null) ? 
             opt_dataPath : 
            'projects/$om.getProject()/subjects/$om.getSubjectId()/' +
            'experiments/$om.getId()';
    }



    //-------------------
    // Set the rootUrl argument -- varies depending on modal state, 
    // hence why we differentiate between dataPath and rootUrl.
    //-------------------
    var rootUrl = (opt_modalState === 'popup') ? '' : 
        serverRoot;


    //-------------------
    // Create the viewer, passing in above arguments.
    //-------------------
    //window.console.log('modal state', modalState);
    var XnatImageViewer = new xiv.start(XIV_STATE, modalState, dataPath, rootUrl);
    XnatImageViewer.setModalType(xiv.ui.Modal);

    //-------------------
    // Track the serverRoot property within xiv.
    //
    // NOTE: We track this because once we enter 'xiv' world, the global
    // property of 'serverRoot' could potentially be minified to something
    // entirely different.
    //-------------------
    XnatImageViewer.setServerRoot(serverRoot); 


    //-------------------
    // Launch the viewer!
    //-------------------
    XnatImageViewer.begin();


    //-------------------
    // Debugs, if needed...
    //-------------------
    //window.console.log('opt_dataPath', opt_dataPath);
    //window.console.log('opt_modalState', opt_modalState);
    //window.console.log('XImgView launch (serverRoot)', serverRoot); 
    //window.console.log('imagePath', imagePath);
};




//
// Special case for popup's that are refreshed
//
if (document.URL.indexOf('popup.html') > -1) {
    launchXImgView('', 'popup', serverRoot);
}

//
// Launch viewer automatically if in demo mode
//
if (XIV_STATE == 'demo') {
    launchXImgView('', '', 'src/main');
    /**
    * For google closure compiling
    xiv.utils.objectAnalyzer.outputExportables({
       'xiv.utils.ErrorCatcher': xiv.utils.ErrorCatcher,
       'xiv.utils.objectAnalyzer': xiv.utils.objectAnalyzer,
    });
    */
}

</script>
</body>


</html>
